**Detect Malware files attached as email using MalwareBazaar IOCs based on SHA256 File data**

```
DeviceEvents
//SCKIPT UB1.C2.K1.T1 Open malicious or infected attachment files
let MalwareBazaarIOCs = externaldata(SHA256: string)["https://bazaar.abuse.ch/export/txt/sha256/recent/"] with (format="txt", ignoreFirstRecord=True);
let SHA256Regex = '[a-fA-F0-9]{64}';
let MaliciousSHA256 = materialize (
          MalwareBazaarIOCs 
          | where SHA256 matches regex SHA256Regex
          | distinct SHA256);
EmailAttachmentInfo
| where SHA256  has_any (MaliciousSHA256)
| project SenderFromAddress, RecipientEmailAddress, FileName, ThreatNames, SHA256, DetectionMethods, ReportId, Timestamp
| sort by Timestamp
```
